<!DOCTYPE html>
<html lang="en">
	<head>
		<title>three.js canvas - particles - random</title>
		<meta charset="utf-8">
		<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
		<style>
			body {
				background-color: #000000;
				margin: 0px;
				overflow: hidden;
			}
			a {
				color:#0078ff;
			}
		</style>
	</head>
	<body>

		<script src="js/three.js"></script>

		<script src="js/renderers/Projector.js"></script>
		<script src="js/renderers/CanvasRenderer.js"></script>

		<script src="js/libs/stats.min.js"></script>
		<script src="js/Detector.js"></script>
		<script src="js/loaders/PLYLoader.js"></script>

		<script>
			var container, stats;
			var camera, scene, renderer, group, particle;
			//var mouseX = 0, mouseY = 0;
			var windowHalfX = window.innerWidth / 2;
			var windowHalfY = window.innerHeight / 2;


			// physics time
			var timeConvert = 1e6;
			var scaleFactorData = [{"a": 0.004645747186113422, "t": -13900000000.0}, {"a": 0.025677577438275638, "t": -13800000000.0}, {"a": 0.04283297727528991, "t": -13700000000.0}, {"a": 0.05787181286751424, "t": -13600000000.0}, {"a": 0.07152842282452726, "t": -13500000000.0}, {"a": 0.08418943799056697, "t": -13400000000.0}, {"a": 0.09608784221426693, "t": -13300000000.0}, {"a": 0.10737700576237248, "t": -13200000000.0}, {"a": 0.11816439112021832, "t": -13100000000.0}, {"a": 0.12852887174668712, "t": -13000000000.0}, {"a": 0.13853045269222797, "t": -12900000000.0}, {"a": 0.14821610746090325, "t": -12800000000.0}, {"a": 0.15762347468729526, "t": -12700000000.0}, {"a": 0.1667833026873446, "t": -12600000000.0}, {"a": 0.17572112478172414, "t": -12500000000.0}, {"a": 0.18445844245838608, "t": -12400000000.0}, {"a": 0.19301358264140697, "t": -12300000000.0}, {"a": 0.2014023327188321, "t": -12200000000.0}, {"a": 0.2096384201009609, "t": -12100000000.0}, {"a": 0.21773388056576826, "t": -12000000000.0}, {"a": 0.22569934546825043, "t": -11900000000.0}, {"a": 0.2335442687113617, "t": -11800000000.0}, {"a": 0.241277108287784, "t": -11700000000.0}, {"a": 0.24890547307456118, "t": -11600000000.0}, {"a": 0.25643624270963644, "t": -11500000000.0}, {"a": 0.2638756663719951, "t": -11400000000.0}, {"a": 0.27122944485191375, "t": -11300000000.0}, {"a": 0.27850279925654114, "t": -11200000000.0}, {"a": 0.2857005289303567, "t": -11100000000.0}, {"a": 0.292827060600034, "t": -11000000000.0}, {"a": 0.2998864903240223, "t": -10900000000.0}, {"a": 0.3068826195005432, "t": -10800000000.0}, {"a": 0.3138189859367119, "t": -10700000000.0}, {"a": 0.3206988907868609, "t": -10600000000.0}, {"a": 0.32752542201591855, "t": -10500000000.0}, {"a": 0.3343014749236963, "t": -10400000000.0}, {"a": 0.3410297701706273, "t": -10300000000.0}, {"a": 0.34771286966927023, "t": -10200000000.0}, {"a": 0.3543531906445201, "t": -10100000000.0}, {"a": 0.3609530181157506, "t": -10000000000.0}, {"a": 0.36751451601359886, "t": -9900000000.0}, {"a": 0.37403973711090494, "t": -9800000000.0}, {"a": 0.38053063191997455, "t": -9700000000.0}, {"a": 0.3869890566856956, "t": -9600000000.0}, {"a": 0.3934167805852093, "t": -9500000000.0}, {"a": 0.3998154922291047, "t": -9400000000.0}, {"a": 0.40618680554590486, "t": -9300000000.0}, {"a": 0.41253226512048935, "t": -9200000000.0}, {"a": 0.4188533510476896, "t": -9100000000.0}, {"a": 0.4251514833543068, "t": -9000000000.0}, {"a": 0.4314280260359952, "t": -8900000000.0}, {"a": 0.4376842907496356, "t": -8800000000.0}, {"a": 0.44392154019683194, "t": -8700000000.0}, {"a": 0.4501409912298703, "t": -8600000000.0}, {"a": 0.45634381770777155, "t": -8500000000.0}, {"a": 0.46253115312686194, "t": -8400000000.0}, {"a": 0.46870409304750005, "t": -8300000000.0}, {"a": 0.47486369733617584, "t": -8200000000.0}, {"a": 0.48101099224008176, "t": -8100000000.0}, {"a": 0.4871469723094073, "t": -8000000000.0}, {"a": 0.49327260218098484, "t": -7900000000.0}, {"a": 0.4993888182354907, "t": -7800000000.0}, {"a": 0.5054965301391481, "t": -7700000000.0}, {"a": 0.5115966222797719, "t": -7600000000.0}, {"a": 0.5176899551060128, "t": -7500000000.0}, {"a": 0.5237773663777914, "t": -7400000000.0}, {"a": 0.5298596723351391, "t": -7300000000.0}, {"a": 0.5359376687919771, "t": -7200000000.0}, {"a": 0.5420121321607525, "t": -7100000000.0}, {"a": 0.5480838204133028, "t": -7000000000.0}, {"a": 0.554153473982833, "t": -6900000000.0}, {"a": 0.5602218166114489, "t": -6800000000.0}, {"a": 0.5662895561472996, "t": -6700000000.0}, {"a": 0.5723573852950261, "t": -6600000000.0}, {"a": 0.5784259823228963, "t": -6500000000.0}, {"a": 0.58449601172972, "t": -6400000000.0}, {"a": 0.5905681248743762, "t": -6300000000.0}, {"a": 0.596642960570554, "t": -6200000000.0}, {"a": 0.6027211456490934, "t": -6100000000.0}, {"a": 0.6088032954901211, "t": -6000000000.0}, {"a": 0.614890014527003, "t": -5900000000.0}, {"a": 0.6209818967239734, "t": -5800000000.0}, {"a": 0.6270795260291607, "t": -5700000000.0}, {"a": 0.6331834768045933, "t": -5600000000.0}, {"a": 0.6392943142346522, "t": -5500000000.0}, {"a": 0.6454125947143279, "t": -5400000000.0}, {"a": 0.6515388662185346, "t": -5300000000.0}, {"a": 0.6576736686536493, "t": -5200000000.0}, {"a": 0.6638175341923528, "t": -5100000000.0}, {"a": 0.669970987592778, "t": -5000000000.0}, {"a": 0.6761345465028963, "t": -4900000000.0}, {"a": 0.68230872175101, "t": -4800000000.0}, {"a": 0.6884940176231577, "t": -4700000000.0}, {"a": 0.6946909321281843, "t": -4600000000.0}, {"a": 0.700899957251179, "t": -4500000000.0}, {"a": 0.7071215791959331, "t": -4400000000.0}, {"a": 0.7133562786170309, "t": -4300000000.0}, {"a": 0.7196045308421444, "t": -4200000000.0}, {"a": 0.7258668060850657, "t": -4100000000.0}, {"a": 0.7321435696499782, "t": -4000000000.0}, {"a": 0.738435282127433, "t": -3900000000.0}, {"a": 0.7447423995824725, "t": -3800000000.0}, {"a": 0.7510653737353095, "t": -3700000000.0}, {"a": 0.7574046521349511, "t": -3600000000.0}, {"a": 0.7637606783261284, "t": -3500000000.0}, {"a": 0.7701338920098731, "t": -3400000000.0}, {"a": 0.7765247291980629, "t": -3300000000.0}, {"a": 0.7829336223622355, "t": -3200000000.0}, {"a": 0.7893610005769562, "t": -3100000000.0}, {"a": 0.7958072896580067, "t": -3000000000.0}, {"a": 0.802272912295646, "t": -2900000000.0}, {"a": 0.8087582881831821, "t": -2800000000.0}, {"a": 0.8152638341410787, "t": -2700000000.0}, {"a": 0.8217899642368083, "t": -2600000000.0}, {"a": 0.8283370899006508, "t": -2500000000.0}, {"a": 0.8349056200376291, "t": -2400000000.0}, {"a": 0.8414959611357573, "t": -2300000000.0}, {"a": 0.8481085173707728, "t": -2200000000.0}, {"a": 0.854743690707511, "t": -2100000000.0}, {"a": 0.8614018809980752, "t": -2000000000.0}, {"a": 0.8680834860769441, "t": -1900000000.0}, {"a": 0.874788901853153, "t": -1800000000.0}, {"a": 0.8815185223996794, "t": -1700000000.0}, {"a": 0.8882727400401531, "t": -1600000000.0}, {"a": 0.8950519454330081, "t": -1500000000.0}, {"a": 0.901856527653187, "t": -1400000000.0}, {"a": 0.9086868742715017, "t": -1300000000.0}, {"a": 0.9155433714317508, "t": -1200000000.0}, {"a": 0.9224264039256878, "t": -1100000000.0}, {"a": 0.9293363552659308, "t": -1000000000.0}, {"a": 0.9362736077568992, "t": -900000000.0}, {"a": 0.943238542563858, "t": -800000000.0}, {"a": 0.9502315397801495, "t": -700000000.0}, {"a": 0.9572529784926844, "t": -600000000.0}, {"a": 0.9643032368457641, "t": -500000000.0}, {"a": 0.971382692103301, "t": -400000000.0}, {"a": 0.9784917207095009, "t": -300000000.0}, {"a": 0.9856306983480694, "t": -200000000.0}, {"a": 0.9928, "t": -100000000.0}, {"a": 1.0, "t": 0.0}, {"a": 1.0072, "t": 100000000.0}, {"a": 1.0144306983480695, "t": 200000000.0}, {"a": 1.0216924671864023, "t": 300000000.0}, {"a": 1.0289856780998483, "t": 400000000.0}, {"a": 1.0363107021685185, "t": 500000000.0}, {"a": 1.0436679100192165, "t": 600000000.0}, {"a": 1.0510576718757412, "t": 700000000.0}, {"a": 1.0584803576081032, "t": 800000000.0}, {"a": 1.0659363367806987, "t": 900000000.0}, {"a": 1.0734259786994762, "t": 1000000000.0}, {"a": 1.080949652458139, "t": 1100000000.0}, {"a": 1.0885077269834162, "t": 1200000000.0}, {"a": 1.0961005710794376, "t": 1300000000.0}, {"a": 1.1037285534712475, "t": 1400000000.0}, {"a": 1.1113920428474877, "t": 1500000000.0}, {"a": 1.1190914079022802, "t": 1600000000.0}, {"a": 1.1268270173763417, "t": 1700000000.0}, {"a": 1.1345992400973541, "t": 1800000000.0}, {"a": 1.1424084450196221, "t": 1900000000.0}, {"a": 1.1502550012630401, "t": 2000000000.0}, {"a": 1.158139278151398, "t": 2100000000.0}, {"a": 1.1660616452500445, "t": 2200000000.0}, {"a": 1.1740224724029364, "t": 2300000000.0}, {"a": 1.1820221297690925, "t": 2400000000.0}, {"a": 1.190060987858474, "t": 2500000000.0}, {"a": 1.198139417567314, "t": 2600000000.0}, {"a": 1.206257790212913, "t": 2700000000.0}, {"a": 1.2144164775679225, "t": 2800000000.0}, {"a": 1.2226158518941315, "t": 2900000000.0}, {"a": 1.2308562859757772, "t": 3000000000.0}, {"a": 1.239138153152395, "t": 3100000000.0}, {"a": 1.2474618273512232, "t": 3200000000.0}, {"a": 1.255827683119181, "t": 3300000000.0}, {"a": 1.2642360956544325, "t": 3400000000.0}, {"a": 1.2726874408375528, "t": 3500000000.0}, {"a": 1.2811820952623107, "t": 3600000000.0}, {"a": 1.2897204362660795, "t": 3700000000.0}, {"a": 1.2983028419598917, "t": 3800000000.0}, {"a": 1.3069296912581494, "t": 3900000000.0}, {"a": 1.3156013639080022, "t": 4000000000.0}, {"a": 1.324318240518405, "t": 4100000000.0}, {"a": 1.333080702588868, "t": 4200000000.0}, {"a": 1.3418891325379068, "t": 4300000000.0}, {"a": 1.3507439137312092, "t": 4400000000.0}, {"a": 1.3596454305095231, "t": 4500000000.0}, {"a": 1.3685940682162792, "t": 4600000000.0}, {"a": 1.3775902132249562, "t": 4700000000.0}, {"a": 1.386634252966201, "t": 4800000000.0}, {"a": 1.3957265759547084, "t": 4900000000.0}, {"a": 1.4048675718158732, "t": 5000000000.0}, {"a": 1.414057631312222, "t": 5100000000.0}, {"a": 1.4232971463696313, "t": 5200000000.0}, {"a": 1.4325865101033435, "t": 5300000000.0}, {"a": 1.441926116843784, "t": 5400000000.0}, {"a": 1.4513163621621918, "t": 5500000000.0}, {"a": 1.4607576428960674, "t": 5600000000.0}, {"a": 1.4702503571744459, "t": 5700000000.0}, {"a": 1.479794904443004, "t": 5800000000.0}, {"a": 1.4893916854890064, "t": 5900000000.0}, {"a": 1.4990411024660946, "t": 6000000000.0}, {"a": 1.508743558918933, "t": 6100000000.0}, {"a": 1.5184994598077095, "t": 6200000000.0}, {"a": 1.528309211532501, "t": 6300000000.0}, {"a": 1.5381732219575102, "t": 6400000000.0}, {"a": 1.548091900435177, "t": 6500000000.0}, {"a": 1.558065657830171, "t": 6600000000.0}, {"a": 1.5680949065432717, "t": 6700000000.0}, {"a": 1.5781800605351386, "t": 6800000000.0}, {"a": 1.58832153534998, "t": 6900000000.0}, {"a": 1.5985197481391225, "t": 7000000000.0}, {"a": 1.6087751176844867, "t": 7100000000.0}, {"a": 1.6190880644219754, "t": 7200000000.0}, {"a": 1.6294590104647764, "t": 7300000000.0}, {"a": 1.6398883796265857, "t": 7400000000.0}, {"a": 1.6503765974447564, "t": 7500000000.0}, {"a": 1.6609240912033747, "t": 7600000000.0}, {"a": 1.67153128995627, "t": 7700000000.0}, {"a": 1.6821986245499614, "t": 7800000000.0}, {"a": 1.6929265276465455, "t": 7900000000.0}, {"a": 1.7037154337465286, "t": 8000000000.0}, {"a": 1.7145657792116076, "t": 8100000000.0}, {"a": 1.7254780022874028, "t": 8200000000.0}, {"a": 1.7364525431261466, "t": 8300000000.0}, {"a": 1.7474898438093311, "t": 8400000000.0}, {"a": 1.7585903483703191, "t": 8500000000.0}, {"a": 1.7697545028169197, "t": 8600000000.0}, {"a": 1.780982755153935, "t": 8700000000.0}, {"a": 1.792275555405678, "t": 8800000000.0}, {"a": 1.8036333556384656, "t": 8900000000.0}, {"a": 1.8150566099830923, "t": 9000000000.0}, {"a": 1.8265457746572837, "t": 9100000000.0}, {"a": 1.8381013079881354, "t": 9200000000.0}, {"a": 1.8497236704345392, "t": 9300000000.0}, {"a": 1.8614133246096003, "t": 9400000000.0}, {"a": 1.873170735303047, "t": 9500000000.0}, {"a": 1.8849963695036356, "t": 9600000000.0}, {"a": 1.896890696421556, "t": 9700000000.0}, {"a": 1.9088541875108365, "t": 9800000000.0}, {"a": 1.920887316491753, "t": 9900000000.0}, {"a": 1.9329905593732448, "t": 10000000000.0}];

			// animation time
			var timeLastFrame = Date.now();				// the time at last frame (just used to get delta time)


			
			var currentIndex = 0;
			var lastScaleFactor = scaleFactorData[0].a;

			// universe time
			var universeTime = scaleFactorData[0].t;



			init();
			animate();

			function drawRandomGaussian() {
				return ((Math.random() + Math.random() + Math.random() + Math.random() + Math.random() + Math.random()) - 3) / 3;
			}

			function init() {
				container = document.createElement( 'div' );
				document.body.appendChild( container );
				camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 1, 50000 );
				camera.position.z = 1000;
				scene = new THREE.Scene();
				var PI2 = Math.PI * 2;
				var program = function ( context ) {
					context.beginPath();
					context.arc( 0, 0, 0.5, 0, PI2, true );
					context.fill();
				};
				group = new THREE.Group();
				scene.add( group );
				for ( var i = 0; i < 1000; i++ ) {
					var material = new THREE.SpriteCanvasMaterial( {
						color: Math.random() * 0x808008 + 0x808080,
						program: program
					} );
					particle = new THREE.Sprite( material );
					particle.position.x = drawRandomGaussian() * 200 ;
					particle.position.y = drawRandomGaussian() * 200;
					particle.position.z = drawRandomGaussian() * 200 ;
					particle.scale.x = particle.scale.y = Math.random() * 30 + 1;
					group.add( particle );
				}
				renderer = new THREE.CanvasRenderer();
				renderer.setPixelRatio( window.devicePixelRatio );
				renderer.setSize( window.innerWidth, window.innerHeight );
				container.appendChild( renderer.domElement );
				stats = new Stats();
				container.appendChild( stats.dom );
				
				//
				window.addEventListener( 'resize', onWindowResize, false );
			}


			function extractScaleFactor (universeTime) {
				// given universTime, find the corresponding scaleFactor in scaleFactorData

				var scaleFactor = lastScaleFactor;

				if (universeTime > scaleFactorData[currentIndex].t) {
					// step forward look for next
					for (var i = currentIndex; i < scaleFactorData.length-2; i++) {
						if (universeTime <= scaleFactorData[i].t) {
							currentIndex = i;
							scaleFactor = scaleFactorData[i].a;
							// console.log('stepped to');
							// console.log(currentIndex);
							break;
						};
					};
				};
				return scaleFactor;

			}

			function scaleUniverse(factor){
				for (i = 0; i < group.children.length; i ++ ){
					particle = group.children[i];
					visualFactor = factor / (lastScaleFactor);
					particle.position.x = particle.position.x * visualFactor;
					particle.position.y = particle.position.y * visualFactor;
					particle.position.z = particle.position.z * visualFactor;
				}
			}

			function onWindowResize() {
				windowHalfX = window.innerWidth / 2;
				windowHalfY = window.innerHeight / 2;
				camera.aspect = window.innerWidth / window.innerHeight;
				camera.updateProjectionMatrix();
				renderer.setSize( window.innerWidth, window.innerHeight );
			}
			//
			function animate() {
				requestAnimationFrame( animate );
				render();
				stats.update();
			}

			function render() {
				var timeNow = Date.now();
				var timeDelta = timeNow - timeLastFrame;
				var scaleFactor;

				// console.log('timeDelta:')
				// console.log(timeDelta)

				universeTime = universeTime + timeDelta*timeConvert; 

				// console.log('universeTime:')
				// console.log(universeTime);

				scaleFactor = extractScaleFactor(universeTime);
				// console.log(scaleFactor);
				//camera.position.x += ( mouseX - camera.position.x ) * 0.05;
				//camera.position.y += ( - mouseY - camera.position.y ) * 0.05;
				scaleUniverse(scaleFactor);
				lastScaleFactor = scaleFactor;
				camera.position.z = 10000;
				camera.lookAt( scene.position );
				//group.rotation.x += 0.01;
				//group.rotation.y += 0.02;
				renderer.render( scene, camera );
				timeLastFrame = timeNow;
			}
		</script>
	</body>
</html>